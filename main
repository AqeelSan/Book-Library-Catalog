#include <iostream>
#include <string>
#include <vector>
#include <map>
#include <algorithm>
using namespace std;

// Define color escape codes
#define RESET "\033[0m"
#define RED "\033[31m"
#define GREEN "\033[32m"
#define YELLOW "\033[33m"
#define BLUE "\033[34m"
#define MAGENTA "\033[35m"
#define CYAN "\033[36m"
#define BOLD "\033[1m"

// Define a structure for a Book
struct Book {
    string title;
    string author;
    int publishYear;
    bool isBorrowed;
};

// Function to convert string to lowercase
string toLowerCase(const string& str) {
    string lowerStr = str;
    transform(lowerStr.begin(), lowerStr.end(), lowerStr.begin(), ::tolower);
    return lowerStr;
}

// Function to display book information
void displayBookInfo(const vector<Book>& books) {
    cout << BOLD << CYAN << "List of Books:" << RESET << endl;
    if (books.empty()) {
        cout << RED << "No books available in the library." << RESET << endl;
        return;
    }

    for (size_t i = 0; i < books.size(); i++) {
        cout << BOLD << GREEN << "Book " << i + 1 << ":" << RESET << endl;
        cout << YELLOW << "Title: " << RESET << books[i].title << endl;
        cout << YELLOW << "Author: " << RESET << books[i].author << endl;
        cout << YELLOW << "Publish Year: " << RESET << books[i].publishYear << endl;
        cout << YELLOW << "Borrowed: " << RESET << (books[i].isBorrowed ? RED "Yes" : GREEN "No") << RESET << endl;
        cout << "----------------------------" << endl;
    }
}

// Function to add a new book
void addBook(vector<Book>& books) {
    Book newBook;
    cout << MAGENTA << "Enter title: " << RESET;
    cin.ignore();
    getline(cin, newBook.title);
    cout << MAGENTA << "Enter author: " << RESET;
    getline(cin, newBook.author);
    cout << MAGENTA << "Enter publish year: " << RESET;
    cin >> newBook.publishYear;
    cout << MAGENTA << "Is the book borrowed? (1 for Yes, 0 for No): " << RESET;
    cin >> newBook.isBorrowed;

    books.push_back(newBook);
    cout << GREEN << "Book added successfully!" << RESET << endl;
}

// Function to remove a book by its index
void removeBook(vector<Book>& books) {
    int index;
    cout << MAGENTA << "Enter the index of the book to remove: " << RESET;
    cin >> index;

    if (index > 0 && index <= books.size()) {
        books.erase(books.begin() + index - 1);
        cout << GREEN << "Book removed successfully!" << RESET << endl;
    } else {
        cout << RED << "Invalid index!" << RESET << endl;
    }
}

// Function to search books by title or author
void searchBooksByTitleOrAuthor(const vector<Book>& books, const string& input) {
    bool found = false;
    string lowerInput = toLowerCase(input);

    for (size_t i = 0; i < books.size(); i++) {
        if (toLowerCase(books[i].title).find(lowerInput) != string::npos || 
            toLowerCase(books[i].author).find(lowerInput) != string::npos) {
            cout << GREEN << "Book found!" << RESET << endl;
            cout << YELLOW << "Title: " << RESET << books[i].title << endl;
            cout << YELLOW << "Author: " << RESET << books[i].author << endl;
            cout << YELLOW << "Publish Year: " << RESET << books[i].publishYear << endl;
            cout << YELLOW << "Borrowed: " << RESET << (books[i].isBorrowed ? RED "Yes" : GREEN "No") << RESET << endl;
            found = true;
        }
    }

    if (!found) {
        cout << RED << "Book with title or author \"" << input << "\" not found." << RESET << endl;
    }
}

// Function to generate reading statistics
void generateStatistics(const vector<Book>& books) {
    int totalBooks = books.size();
    int borrowedBooks = 0;

    map<int, int> yearDistribution;

    for (const auto& book : books) {
        if (book.isBorrowed) {
            borrowedBooks++;
        }
        yearDistribution[book.publishYear]++;
    }

    cout << BOLD << CYAN << "Reading Statistics:" << RESET << endl;
    cout << YELLOW << "Total number of books: " << RESET << totalBooks << endl;
    cout << YELLOW << "Number of borrowed books: " << RESET << borrowedBooks << endl;
    cout << YELLOW << "Year-wise distribution of books:" << RESET << endl;

    for (const auto& entry : yearDistribution) {
        cout << GREEN << "Year " << entry.first << ": " << entry.second << " book(s)" << RESET << endl;
    }
}

int main() {
    vector<Book> books = {
        {"The Hobbit", "J.R.R. Tolkien", 1937, false},
        {"1984", "George Orwell", 1949, true},
        {"To Kill a Mockingbird", "Harper Lee", 1960, false},
        {"The Great Gatsby", "F. Scott Fitzgerald", 1925, true},
        {"Moby Dick", "Herman Melville", 1851, false},
        {"War and Peace", "Leo Tolstoy", 1869, true},
        {"Pride and Prejudice", "Jane Austen", 1813, false},
        {"The Catcher in the Rye", "J.D. Salinger", 1951, true},
        {"The Odyssey", "Homer", 1800, false},
        {"Ulysses", "James Joyce", 1922, true}
    };

    int choice;
    do {
        cout << BOLD << CYAN << "\nBook Library Catalog Menu" << RESET << endl;
        cout << YELLOW << "1. Display Books" << RESET << endl;
        cout << YELLOW << "2. Add Book" << RESET << endl;
        cout << YELLOW << "3. Remove Book" << RESET << endl;
        cout << YELLOW << "4. Search Book by Title or Author" << RESET << endl;
        cout << YELLOW << "5. Generate Reading Statistics" << RESET << endl;
        cout << YELLOW << "6. Exit" << RESET << endl;
        cout << MAGENTA << "Enter your choice: " << RESET;
        cin >> choice;

        switch (choice) {
            case 1:
                displayBookInfo(books);
                break;
            case 2:
                addBook(books);
                break;
            case 3:
                removeBook(books);
                break;
            case 4: {
                string input;
                cout << MAGENTA << "Enter title or author to search: " << RESET;
                cin.ignore();
                getline(cin, input);
                searchBooksByTitleOrAuthor(books, input);
                break;
            }
            case 5:
                generateStatistics(books);
                break;
            case 6:
                cout << GREEN << "Exiting... Goodbye!" << RESET << endl;
                break;
            default:
                cout << RED << "Invalid choice! Please try again." << RESET << endl;
                break;
        }
    } while (choice != 6);

    return 0;
}
